This add-on is an editor for html or css source code using a <a href="https://codemirror.net/" rel="nofollow">codemirror</a> instance. 

This editor offers syntax highlighting and a built-in search. You can adjust the <a href="https://codemirror.net/demo/theme.html" rel="nofollow">theme</a> and key layout it uses ("sublime","emacs","vim"). 

This editor is used for two functions: 

1. In the anki editor you can edit the source code of a field:
<img src="https://raw.githubusercontent.com/ijgnd/anki__editor_edit_html_extended/master/screenshots/field.png"> 

2. You can edit the Front Template, Styling, or Back Template in the Card Layout window. There's an additional entry in the context menu when you right-click on of those fields.
<img src="https://raw.githubusercontent.com/ijgnd/anki__editor_edit_html_extended/master/screenshots/clayout.png"> 

When you edit in the Card Layout window you can also save a version and then later compare it (or restore with copy and paste). 

The dialog that lists versions (on the left in the following window) has a dropdown menu that lists all saved versions of the form you edit. Under the dropdown menu you have a simple preview of this saved version.
On the top right of this versions window there's a button "open folder" which shows the folder that contains the saved versions in your file explorer.
On the lower left there's a button "Diff with current" that diffs what you have in the extended editor and what you selected in the dropdown menu in an external program. The latter option requires that you adjust the add-on config.
<img src="https://raw.githubusercontent.com/ijgnd/anki__editor_edit_html_extended/master/screenshots/clayout_with_prior_versions_markup.png"> 


<b># Editing a field</b>
By default it makes the source code more readable by using the function prettify of the python package beautifulsoup. You can also use functions from luoliyan's recent great add-on <a href="https://ankiweb.net/shared/info/410936778" rel="nofollow">HTML Editor Tweaks</a>. After closing it tries to minify the source code with 
<a href="https://github.com/mankyd/htmlmin" rel="nofollow">htmlmin</a> (configurable).

If you click the add-on button while holding the shift-key you revert the field to the state before you opened this html source view.

When you open the window the cursor position is synced by reusing code from glutanimate's <a href="https://ankiweb.net/shared/info/138856093" rel="nofollow">Sync Cursor Between Fields and HTML Editor</a>. When you close the window the cursor is not synced.

<b># Limitations</b>
This add-on does not save the front/css/back per card template. Instead all fronts are saved into one folder for one note type. This is not good if you use many quite similar card templates. If this add-on used a different subfolder for each card template the folder names would have to be adjusted whenever the card templates are reordered (repositioned). I'd have to wrap onReorder. That's on my todo list.

This add-on loads a webpage. On my computer I don't notice a speed difference. But it your computer is slow or you put many thousands of words into a field (as in incremental reading) it will be slower.

This add-on doesn't replace the built-in html view but uses it's own shortcut that you can adjust. 

Use it at your own risk. This add-on also optionally reuses another function from luoliyan's add-on for folding the html after you finished editing. So the warning from <a href="https://ankiweb.net/shared/info/410936778" rel="nofollow">HTML Editor Tweaks</a> also applies here. 

<b># bugs</b>
No support, if you find a bug let me know on <a href="https://github.com/ijgnd/anki__editor_edit_html_extended" rel="nofollow">github</a> - maybe I'll have an idea. Also pull requests, improvements and feedback is welcome. 

<b># some useful keycombos for the default keymap</b>:
- "Esc": Close window, discard changes
- "Ctrl+F": Find
- "Ctrl-H": Replace
- "Ctrl-Alt-Up": addCursorToPrevLine
- "Ctrl-Alt-Down": addCursorToNextLine
- "Ctrl-F3": search for word under cursor (findUnderNext)
- "Shift-Ctrl-F3": search for word under cursor backwards (findUnderPrevious)

<b># Versions</b>
- 2020-07-14 update for 2.1.28, fix unicode error in windows, fix some no prior versions error, no error shown when external editor is missing, update codemirror, etc.
- 2020-04-27 diff enhancements, diff error fixed, codemirror update, more robust against config errors
- 2019-11-24 add save/diff when in card layout dialog
- 2019-11-23 card layout dialog
- 2019-10-28 minify with htmlmin to destroy less formatting, sync cursor when opening, highlight active line
- 2019-06-10 first release

<b> Other Authors</b>
- Joseph Lorimer/luoliyan
- Detlev Offenbach
- Marijn Haverbeke and others
- Dave Mankoff
